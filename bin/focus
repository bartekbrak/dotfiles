#!/usr/bin/env python3
import time, sys, os


FILE = '/dev/shm/focus'
INTERVAL=1
DUR=3600

def remove():
    if os.path.isfile(FILE):
        os.remove(FILE)

def stop():
    os.system('/usr/bin/i3-msg bar mode invisible')

while True:
    if os.path.isfile(FILE):
        with open(FILE, 'r') as f:
            start = int(f.read().strip())
            left = int(start + DUR - time.time())
            if left <= 0:
                remove()
                stop()
            sys.stdout.write(f'FOCUS {left // 60}m{left % 60}s ' * 20)
            sys.stdout.flush()
    time.sleep(INTERVAL)
